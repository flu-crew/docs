
== octofludb

=== deleting data

In the August OFFLU report process, we updated the octoFLU reference files to
better represent the global H3 clades. If we directly upload the new H3 clades
to octofludb, then we will end up with duplicate records. So we must first
delete all prior non-USA H3 clades. The SPARQL deletion statement for this is
shown below.

[source,sparql]
----
PREFIX f: <https://flu-crew.org/term/>

DELETE {
    ?gid f:clade ?clade .
    ?gid f:gl_clade ?gl_clade .
}
WHERE {
  ?sid f:strain_name ?strain_name .
  ?sid f:country/f:code ?country .
  ?sid f:host "swine" .

  FILTER (?country != "USA") .

  ?sid f:subtype ?subtype .
  FILTER REGEX(?subtype, "H3") .

  ?sid f:has_segment ?gid .
  ?gid f:segment_name "HA" .

  OPTIONAL { ?gid f:clade ?clade . }
  OPTIONAL { ?gid f:gl_clade ?gl_clade . }
}
----

The WHERE clause defines a set of triples and the DELETE clause specifies which
of these triples should be removed.

This command should be written to a file (say, `delete-global-H3-clades.rq`)
and then can be applied to the local database with the command:

----
octofludb update delete-global-H3-clades.rq
----

It is generally good practice to check before we delete. For example, if we
accidentally added the triple `?sid f:has_segment ?gid` to the DELETE clause,
then we would delete the links from strains to segments. An easy way to check
what will be deleted is to create the corresponding query statement:


[source,sparql]
----
PREFIX f: <https://flu-crew.org/term/>

SELECT *
WHERE {
   ....
}
----

With the WHERE clause being the same as before. The calling `octofludb query`
to get a table showing all cases where clade info will be deleted.
